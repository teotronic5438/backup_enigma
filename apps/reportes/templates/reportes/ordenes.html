{% extends "base.html" %}

{% block title %}Reporte de rdenes{% endblock %}

{% block content %}
<div class="container-fluid px-4 mt-3">

    <!--  Encabezado -->
    <div class="d-flex align-items-center mb-4">
        <i class="bi bi-card-list fs-3 text-primary me-2"></i>
        <h3 class="fw-bold text-primary m-0">Reporte de rdenes</h3>
    </div>

    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb bg-light rounded p-2">
            <li class="breadcrumb-item"><i class="bi bi-house-door"></i> Inicio</li>
            <li class="breadcrumb-item">rdenes</li>
            <li class="breadcrumb-item text-primary" aria-current="page">Reporte</li>
        </ol>
    </nav>

    <!-- Filtros -->
    <form method="get" class="mb-4">
        {{ form.as_p }}
        <button type="submit" class="btn btn-primary">Filtrar</button>
        <a href="{% url 'reportes:exportar_ordenes_csv' %}?{{ request.GET.urlencode }}" class="btn btn-success">Exportar CSV</a>
        <a href="{% url 'reportes:exportar_ordenes_excel' %}?{{ request.GET.urlencode }}" class="btn btn-success">Exportar Excel</a>
    </form>

    <!-- Resumen -->
    <div class="row mb-4">
        <div class="col-md-4">
            <div class="card text-white bg-primary mb-3">
                <div class="card-body">
                    <h5 class="card-title">rdenes pendientes</h5>
                    <p class="card-text fs-3">{{ total_pendientes }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-success mb-3">
                <div class="card-body">
                    <h5 class="card-title">rdenes completadas</h5>
                    <p class="card-text fs-3">{{ total_completadas }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card text-white bg-danger mb-3">
                <div class="card-body">
                    <h5 class="card-title">rdenes aver铆a / destrucci贸n</h5>
                    <p class="card-text fs-3">{{ total_averia_destruccion }}</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tabla de 贸rdenes -->
    {% if ordenes %}
    <table class="table table-bordered">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Modelo</th>
                <th>Estado</th>
                <th>Tipo Acci贸n</th>
                <th>Fecha Creaci贸n</th>
                <th>Fecha Modificaci贸n</th>
                <th>Activo</th>
                <th>Usuario</th>
            </tr>
        </thead>
        <tbody>
            {% for o in ordenes %}
            <tr>
                <td>{{ o.id }}</td>
                <td>{{ o.modelo }}</td>
                <td>{{ o.estado }}</td>
                <td>{{ o.tipo_accion }}</td>
                <td>{{ o.fecha_creacion|date:"d/m/Y H:i" }}</td>
                <td>{{ o.fecha_modificacion|date:"d/m/Y H:i" }}</td>
                <td>{{ o.activo }}</td>
                <td>{% if o.usuario %}
                        {{ o.usuario.nombre }}
                    {% else %}
                        -
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No se encontraron 贸rdenes.</p>
    {% endif %}

</div>
{% endblock %}
